<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Create Order</title>-->
<!--</head>-->
<!--<body>-->
<!--<h1>Create Order</h1>-->

<!--<form id="orderForm">-->
<!--    <div id="products">-->
<!--        <div th:each="product : ${allProducts}">-->
<!--            <label th:text="${product.productName}"></label>-->
<!--            <input type="number" name="selectedProducts[__${product.productId}__]" min="0">-->
<!--            <br>-->
<!--        </div>-->
<!--    </div>-->

<!--    <button type="button" onclick="submitOrder()">Create Order</button>-->
<!--</form>-->

<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->

<!--<script th:inline="javascript">-->
<!--    /*<![CDATA[*/-->
<!--    var allProducts = /*[[${allProducts}]]*/;-->

<!--    function submitOrder() {-->
<!--        var form = document.getElementById("orderForm");-->
<!--        var formData = new FormData(form);-->

<!--        var selectedProducts = {};-->
<!--        var selectedProductInputs = document.querySelectorAll("input[name^='selectedProducts']");-->
<!--        selectedProductInputs.forEach(function(input) {-->
<!--            var productId = input.name.match(/\d+/)[0];-->
<!--            var quantity = input.value;-->
<!--            selectedProducts[productId] = quantity;-->
<!--        });-->

<!--        formData.delete("selectedProducts");-->
<!--        formData.append("partnerId", /*[[${partner.id}]]*/);-->

<!--        for (var productId in selectedProducts) {-->
<!--            if (selectedProducts.hasOwnProperty(productId)) {-->
<!--                formData.append("selectedProducts[" + productId + "]", selectedProducts[productId]);-->
<!--            }-->
<!--        }-->

<!--        fetch("/api/orders/{partnerId}", {-->
<!--            method: "POST",-->
<!--            body: formData-->
<!--        }).then(function(response) {-->
<!--            if (response.ok) {-->
<!--                alert("Order created successfully!");-->
<!--                window.location.href = "/createOrder";-->
<!--            } else {-->
<!--                alert("Failed to create order.");-->
<!--            }-->
<!--        }).catch(function(error) {-->
<!--            alert("An error occurred: " + error.message);-->
<!--        });-->
<!--    }-->
<!--    /*]]>*/-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Create Order</title>
</head>
<body>
<h1>Create Order</h1>

<form id="orderForm" th:action="@{/api/orders/{partnerId}(partnerId=${partner.id})}" th:method="post">
    <div id="products">
        <div th:each="product : ${allProducts}">
            <label th:text="${product.productName}"></label>
            <input type="number" th:name="selectedProducts[__${product.productId}__]" min="0">
            <br>
        </div>
    </div>

    <button type="button" onclick="submitOrder()">Create Order</button>
<!--    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
</form>

<script th:inline="javascript">
        /*<![CDATA[*/
function submitOrder() {
    var selectedProducts = [];
    var quantityInputs = document.querySelectorAll(".product-quantity");

    quantityInputs.forEach(function(input) {
        var productId = input.getAttribute("data-product-id");
        var quantity = input.value;
        selectedProducts.push({ productId: parseInt(productId), quantity: parseInt(quantity) });
    });

    var partnerId = /*[[${partner.id}]]*/;

    fetch("/api/orders/" + partnerId, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(selectedProducts)
    }).then(function(response) {
        if (response.ok) {
            alert("Order created successfully!");
            window.location.href = "/order/createOrder/" + partnerId;
        } else {
            alert("Failed to create order.");
        }
    }).catch(function(error) {
        alert("An error occurred: " + error.message);
    });
}
        /*]]>*/
    </script>
</body>
</html>